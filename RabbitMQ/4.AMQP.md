# 第四章 AMQP

## 4.1. 相关概念介绍

AMQP 一个提供统一消息服务的应用层标准高级消息队列协议，是应用层协议的一个开放标准，为面向消息的中间件设计。

RabbitMQ是AMQP协议的Erlang的实现。

| **概念**            | **说明**                                                     |
| ----------------- | ---------------------------------------------------------- |
| 连接Connection&#xA; | 一个网络连接，比如TCP/IP套接字连接。&#xA;                                 |
| 信道Channel&#xA;    | 多路复用连接中的一条独立的双向数据流通道。为会话提供物理传输介质。&#xA;                     |
| 客户端Client&#xA;    | AMQP连接或者会话的发起者。AMQP是非对称的，客户端生产和消费消息，服务器存储和路由这些消息。&#xA;     |
| 服务节点Broker&#xA;   | 消息中间件的服务节点；一般情况下可以将一个RabbitMQ Broker看作一台RabbitMQ 服务器。&#xA; |
| 端点&#xA;           | AMQP对话的任意一方。一个AMQP连接包括两个端点（一个是客户端，一个是服务器）。&#xA;            |
| 消费者Consumer&#xA;  | 一个从消息队列里请求消息的客户端程序。&#xA;                                   |
| 生产者Producer&#xA;  | 一个向交换机发布消息的客户端应用程序。&#xA;                                   |

## 4.2. RabbitMQ运转流程

在入门案例中：

-   生产者发送消息

1.  生产者创建连接（Connection），开启一个信道（Channel），连接到RabbitMQ Broker；
2.  声明队列并设置属性；如是否排它，是否持久化，是否自动删除；
3.  将路由键（空字符串）与队列绑定起来；
4.  发送消息至RabbitMQ Broker；
5.  关闭信道；
6.  关闭连接；

-   消费者接收消息

1.  消费者创建连接（Connection），开启一个信道（Channel），连接到RabbitMQ Broker
2.  向Broker 请求消费相应队列中的消息，设置相应的回调函数；
3.  等待Broker投递响应队列中的消息，消费者接收消息；
4.  确认（ack，自动确认）接收到的消息；
5.  RabbitMQ从队列中删除相应已经被确认的消息；
6.  关闭信道；
7.  关闭连接；

![](image/image_27_tbHFCarOZ4.png)

